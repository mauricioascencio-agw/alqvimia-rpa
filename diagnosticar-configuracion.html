<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Diagn√≥stico - Configuraci√≥n SMTP</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #fff;
        }
        .section {
            background: #252525;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 3px solid #4CAF50;
        }
        .error {
            border-left-color: #f44336;
        }
        .warning {
            border-left-color: #ff9800;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background: #45a049;
        }
        pre {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîç Diagn√≥stico de Configuraci√≥n SMTP</h1>

    <div class="section">
        <h2>1. LocalStorage</h2>
        <button onclick="checkLocalStorage()">Verificar LocalStorage</button>
        <pre id="localStorageResult">Esperando...</pre>
    </div>

    <div class="section">
        <h2>2. Configuraci√≥n SMTP Actual</h2>
        <button onclick="checkSmtpConfig()">Ver Configuraci√≥n</button>
        <pre id="smtpConfigResult">Esperando...</pre>
    </div>

    <div class="section">
        <h2>3. Estado del Checkbox</h2>
        <button onclick="checkCheckbox()">Verificar Checkbox</button>
        <pre id="checkboxResult">Esperando...</pre>
    </div>

    <div class="section warning">
        <h2>4. Habilitar SMTP Manualmente</h2>
        <button onclick="enableSmtp()">‚úÖ Activar SMTP Enabled</button>
        <button onclick="disableSmtp()">‚ùå Desactivar SMTP Enabled</button>
        <pre id="enableResult">Esperando...</pre>
    </div>

    <div class="section">
        <h2>5. Configuraci√≥n de Prueba</h2>
        <button onclick="setTestConfig()">Configurar Gmail de Prueba</button>
        <pre id="testConfigResult">Esperando...</pre>
    </div>

    <div class="section error">
        <h2>6. Limpiar Todo</h2>
        <button onclick="clearAll()" style="background: #f44336;">üóëÔ∏è Limpiar LocalStorage</button>
        <pre id="clearResult">Esperando...</pre>
    </div>

    <script>
        function checkLocalStorage() {
            const settings = localStorage.getItem('app_settings');
            const result = document.getElementById('localStorageResult');

            if (!settings) {
                result.innerHTML = '‚ùå No hay configuraciones guardadas en localStorage';
                return;
            }

            try {
                const parsed = JSON.parse(settings);
                result.innerHTML = '‚úÖ Configuraciones encontradas:\n\n' + JSON.stringify(parsed, null, 2);
            } catch (e) {
                result.innerHTML = '‚ùå Error al parsear: ' + e.message;
            }
        }

        function checkSmtpConfig() {
            const settings = localStorage.getItem('app_settings');
            const result = document.getElementById('smtpConfigResult');

            if (!settings) {
                result.innerHTML = '‚ùå No hay configuraciones';
                return;
            }

            try {
                const parsed = JSON.parse(settings);
                const smtp = parsed.videoConference?.smtp;

                if (!smtp) {
                    result.innerHTML = '‚ùå No existe configuraci√≥n videoConference.smtp';
                    return;
                }

                result.innerHTML = '‚úÖ Configuraci√≥n SMTP:\n\n' +
                    'enabled: ' + smtp.enabled + '\n' +
                    'host: ' + smtp.host + '\n' +
                    'port: ' + smtp.port + '\n' +
                    'user: ' + smtp.user + '\n' +
                    'password: ' + (smtp.password ? '***' : '(vac√≠o)') + '\n' +
                    'fromName: ' + smtp.fromName + '\n' +
                    'fromEmail: ' + smtp.fromEmail;
            } catch (e) {
                result.innerHTML = '‚ùå Error: ' + e.message;
            }
        }

        function checkCheckbox() {
            const result = document.getElementById('checkboxResult');

            // Simular que vamos a configuraciones
            result.innerHTML = 'Para verificar el checkbox:\n\n' +
                '1. Abre http://localhost:3000\n' +
                '2. Click en Configuraciones (‚öôÔ∏è)\n' +
                '3. Click en pesta√±a "Videoconferencia"\n' +
                '4. Verifica si el checkbox est√° marcado\n' +
                '5. Si no est√° marcado, m√°rcalo primero';
        }

        function enableSmtp() {
            const settings = localStorage.getItem('app_settings');
            const result = document.getElementById('enableResult');

            try {
                let parsed = settings ? JSON.parse(settings) : {};

                if (!parsed.videoConference) {
                    parsed.videoConference = {
                        smtp: {
                            enabled: false,
                            host: '',
                            port: 587,
                            secure: false,
                            user: '',
                            password: '',
                            fromName: 'Alqvimia Videoconferencia',
                            fromEmail: ''
                        }
                    };
                }

                parsed.videoConference.smtp.enabled = true;

                localStorage.setItem('app_settings', JSON.stringify(parsed));

                result.innerHTML = '‚úÖ SMTP habilitado correctamente!\n\n' +
                    'Ahora:\n' +
                    '1. Ve a http://localhost:3000\n' +
                    '2. Presiona F5 para refrescar\n' +
                    '3. Ve a Configuraciones ‚Üí Videoconferencia\n' +
                    '4. Los campos deber√≠an estar habilitados';
            } catch (e) {
                result.innerHTML = '‚ùå Error: ' + e.message;
            }
        }

        function disableSmtp() {
            const settings = localStorage.getItem('app_settings');
            const result = document.getElementById('enableResult');

            try {
                let parsed = settings ? JSON.parse(settings) : {};

                if (parsed.videoConference?.smtp) {
                    parsed.videoConference.smtp.enabled = false;
                    localStorage.setItem('app_settings', JSON.stringify(parsed));
                    result.innerHTML = '‚úÖ SMTP deshabilitado';
                } else {
                    result.innerHTML = '‚ùå No existe configuraci√≥n SMTP';
                }
            } catch (e) {
                result.innerHTML = '‚ùå Error: ' + e.message;
            }
        }

        function setTestConfig() {
            const settings = localStorage.getItem('app_settings');
            const result = document.getElementById('testConfigResult');

            try {
                let parsed = settings ? JSON.parse(settings) : {};

                if (!parsed.videoConference) {
                    parsed.videoConference = {};
                }

                parsed.videoConference.smtp = {
                    enabled: true,
                    host: 'smtp.gmail.com',
                    port: 587,
                    secure: false,
                    user: 'tu-email@gmail.com',
                    password: '',
                    fromName: 'Alqvimia Videoconferencia',
                    fromEmail: 'noreply@alqvimia.com'
                };

                localStorage.setItem('app_settings', JSON.stringify(parsed));

                result.innerHTML = '‚úÖ Configuraci√≥n de prueba establecida!\n\n' +
                    'Host: smtp.gmail.com\n' +
                    'Puerto: 587\n' +
                    'Usuario: tu-email@gmail.com\n\n' +
                    'IMPORTANTE: Debes agregar tu email y contrase√±a real en la UI';
            } catch (e) {
                result.innerHTML = '‚ùå Error: ' + e.message;
            }
        }

        function clearAll() {
            if (confirm('¬øEst√°s seguro? Esto eliminar√° TODAS las configuraciones')) {
                localStorage.removeItem('app_settings');
                document.getElementById('clearResult').innerHTML = '‚úÖ LocalStorage limpiado\n\nRefr esca la p√°gina principal para cargar configuraci√≥n por defecto';
            }
        }

        // Auto-check al cargar
        checkLocalStorage();
        checkSmtpConfig();
    </script>
</body>
</html>
