<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alqvimia - RPA Automation Tool</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/workflow-studio.css">
    <link rel="stylesheet" href="css/recorder-improvements.css">
    <link rel="stylesheet" href="css/workflow-categories.css">
    <link rel="stylesheet" href="css/mcp-styles.css">
    <link rel="stylesheet" href="css/settings-styles.css">
    <link rel="stylesheet" href="css/database-styles.css">
    <link rel="stylesheet" href="css/variables-styles.css">
    <link rel="stylesheet" href="css/resizable-panels.css">
    <link rel="stylesheet" href="css/omnichannel-styles.css">
    <link rel="stylesheet" href="css/video-conference.css">
    <link rel="stylesheet" href="css/video-conference-save-config.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <i class="fas fa-robot"></i>
                <h1>Alqvimia</h1>
                <span class="version">v1.0</span>
            </div>
            <div class="header-right">
                <div class="connection-toggle-container">
                    <span class="connection-label" id="connectionLabel">Desconectado</span>
                    <label class="connection-switch">
                        <input type="checkbox" id="connectionToggle">
                        <span class="connection-slider"></span>
                    </label>
                    <span class="connection-status-text" id="connectionStatusText">Haz clic para conectar</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar" id="mainSidebar">
                <div class="sidebar-header">
                    <button class="sidebar-toggle" id="sidebarToggle" title="Contraer menú">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
                <nav class="sidebar-nav">
                    <button class="nav-item active" data-view="spy" data-tooltip="Element Spy">
                        <i class="fas fa-search"></i>
                        <span>Element Spy</span>
                    </button>
                    <button class="nav-item" data-view="recorder" data-tooltip="Grabador">
                        <i class="fas fa-video"></i>
                        <span>Grabador</span>
                    </button>
                    <button class="nav-item" data-view="workflows" data-tooltip="Workflows">
                        <i class="fas fa-project-diagram"></i>
                        <span>Workflows</span>
                    </button>
                    <button class="nav-item" data-view="executor" data-tooltip="Ejecutor">
                        <i class="fas fa-play-circle"></i>
                        <span>Ejecutor</span>
                    </button>
                    <button class="nav-item" data-view="library" data-tooltip="Biblioteca">
                        <i class="fas fa-folder-open"></i>
                        <span>Biblioteca</span>
                    </button>
                    <button class="nav-item" data-view="ai-dashboard" data-tooltip="IA Dashboard">
                        <i class="fas fa-brain"></i>
                        <span>IA Dashboard</span>
                    </button>
                    <button class="nav-item" data-view="omnichannel" data-tooltip="Omnicanalidad">
                        <i class="fas fa-comments"></i>
                        <span>Omnicanalidad</span>
                    </button>
                    <button class="nav-item" id="videoconference-btn" data-tooltip="Videoconferencia">
                        <i class="fas fa-video"></i>
                        <span>Videoconferencia</span>
                    </button>
                </nav>
            </aside>

            <!-- Content Area -->
            <main class="content-area">
                <!-- Element Spy View -->
                <div class="view active" id="spy-view">
                    <div class="view-header">
                        <h2><i class="fas fa-search"></i> Element Spy Inspector</h2>
                        <p>Inspecciona y captura elementos de páginas web con selectores avanzados</p>
                    </div>

                    <div class="spy-tools">
                        <div class="tool-group">
                            <label>URL de la página:</label>
                            <div class="input-group">
                                <input type="text" id="spyUrl" placeholder="https://ejemplo.com" value="https://www.google.com">
                                <button class="btn btn-primary" id="launchSpy">
                                    <i class="fas fa-rocket"></i> Lanzar Spy
                                </button>
                            </div>
                        </div>

                        <div class="spy-features">
                            <div class="feature-card">
                                <i class="fas fa-crosshairs"></i>
                                <h3>Selector Picker</h3>
                                <p>Haz clic en cualquier elemento para obtener su selector</p>
                            </div>
                            <div class="feature-card">
                                <i class="fas fa-code"></i>
                                <h3>Múltiples Selectores</h3>
                                <p>CSS, XPath, ID, Class, Name</p>
                            </div>
                            <div class="feature-card">
                                <i class="fas fa-eye"></i>
                                <h3>Vista Previa</h3>
                                <p>Visualiza el elemento seleccionado en tiempo real</p>
                            </div>
                        </div>

                        <div class="element-inspector" id="elementInspector" style="display:none;">
                            <h3>Elemento Seleccionado</h3>
                            <div class="inspector-grid">
                                <div class="inspector-item">
                                    <label>Tag:</label>
                                    <input type="text" id="elemTag" readonly>
                                </div>
                                <div class="inspector-item">
                                    <label>ID:</label>
                                    <input type="text" id="elemId" readonly>
                                </div>
                                <div class="inspector-item">
                                    <label>Class:</label>
                                    <input type="text" id="elemClass" readonly>
                                </div>
                                <div class="inspector-item">
                                    <label>Name:</label>
                                    <input type="text" id="elemName" readonly>
                                </div>
                            </div>

                            <div class="selector-options">
                                <h4>Selectores Disponibles:</h4>
                                <div class="selector-list" id="selectorList"></div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-success" id="addToWorkflow">
                                    <i class="fas fa-plus"></i> Agregar a Workflow
                                </button>
                                <button class="btn btn-secondary" id="copySelector">
                                    <i class="fas fa-copy"></i> Copiar Selector
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recorder View -->
                <div class="view" id="recorder-view">
                    <div class="view-header">
                        <h2><i class="fas fa-video"></i> Grabador de Acciones</h2>
                        <p>Graba interacciones automáticamente para crear workflows</p>
                    </div>

                    <div class="recorder-controls">
                        <div class="control-panel">
                            <button class="btn btn-danger btn-lg" id="startRecording">
                                <i class="fas fa-circle"></i> Iniciar Grabación
                            </button>
                            <button class="btn btn-secondary btn-lg" id="stopRecording" disabled>
                                <i class="fas fa-stop"></i> Detener
                            </button>
                            <button class="btn btn-primary btn-lg" id="pauseRecording" disabled>
                                <i class="fas fa-pause"></i> Pausar
                            </button>
                        </div>

                        <div class="recording-status" id="recordingStatus">
                            <i class="fas fa-info-circle"></i>
                            <span>Listo para grabar</span>
                        </div>
                    </div>

                    <div class="recorded-actions">
                        <h3>Acciones Grabadas <span id="actionCount">(0)</span></h3>
                        <div class="actions-list" id="recordedActionsList">
                            <div class="empty-state">
                                <i class="fas fa-video-slash"></i>
                                <p>No hay acciones grabadas</p>
                                <small>Inicia la grabación para capturar acciones</small>
                            </div>
                        </div>
                    </div>

                    <div class="recorder-footer">
                        <button class="btn btn-success" id="saveRecording" disabled>
                            <i class="fas fa-save"></i> Guardar como Workflow
                        </button>
                        <button class="btn btn-warning" id="clearRecording" disabled>
                            <i class="fas fa-trash"></i> Limpiar
                        </button>
                    </div>
                </div>

                <!-- Workflows View -->
                <div class="view" id="workflows-view">
                    <div class="workflow-studio" id="workflowStudio">
                        <!-- Header con tabs -->
                        <div class="studio-header">
                            <div class="workflow-tabs" id="workflowTabs">
                                <button class="workflow-tab active" data-tab="main">
                                    <i class="fas fa-file"></i>
                                    <span id="currentWorkflowName">Mi Workflow</span>
                                    <i class="fas fa-times close-tab" onclick="WorkflowStudio.closeTab('main')"></i>
                                </button>
                            </div>
                            <button class="btn btn-sm btn-primary" onclick="WorkflowStudio.newTab()">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>

                        <!-- Panel Izquierdo - Acciones -->
                        <div class="studio-left-panel" id="leftPanel">
                            <div class="panel-header">
                                <h3>
                                    <i class="fas fa-th-large"></i>
                                    Acciones
                                </h3>
                                <button class="panel-collapse-btn" onclick="WorkflowStudio.toggleLeftPanel()">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                            </div>

                            <div class="actions-search">
                                <input type="text" placeholder="Buscar acciones..." id="actionsSearch" oninput="WorkflowStudio.filterActions(this.value)">
                            </div>

                            <div class="actions-list" id="actionsList">

                                <!-- Categoría: Web Browser -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-globe category-icon"></i>
                                        <span class="category-name">Navegador Web</span>
                                        <span class="category-count">8</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="browser_open">
                                            <i class="fas fa-window-maximize"></i>
                                            <span>Abrir Navegador</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="navigate">
                                            <i class="fas fa-compass"></i>
                                            <span>Navegar a URL</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="click">
                                            <i class="fas fa-mouse-pointer"></i>
                                            <span>Hacer Clic</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="type">
                                            <i class="fas fa-keyboard"></i>
                                            <span>Escribir Texto</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="extract_text">
                                            <i class="fas fa-font"></i>
                                            <span>Extraer Texto</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="screenshot">
                                            <i class="fas fa-camera"></i>
                                            <span>Captura de Pantalla</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="scroll">
                                            <i class="fas fa-arrows-alt-v"></i>
                                            <span>Hacer Scroll</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="browser_close">
                                            <i class="fas fa-times-circle"></i>
                                            <span>Cerrar Navegador</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Active Directory -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-users-cog category-icon"></i>
                                        <span class="category-name">Active Directory</span>
                                        <span class="category-count">5</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="ad_connect">
                                            <i class="fas fa-server"></i>
                                            <span>Conectar AD</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="ad_get_user">
                                            <i class="fas fa-user"></i>
                                            <span>Obtener Usuario</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="ad_create_user">
                                            <i class="fas fa-user-plus"></i>
                                            <span>Crear Usuario</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="ad_disable_user">
                                            <i class="fas fa-user-lock"></i>
                                            <span>Deshabilitar Usuario</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="ad_add_to_group">
                                            <i class="fas fa-users"></i>
                                            <span>Agregar a Grupo</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: AI -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-brain category-icon"></i>
                                        <span class="category-name">Inteligencia Artificial</span>
                                        <span class="category-count">4</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="ai_text_generation">
                                            <i class="fas fa-robot"></i>
                                            <span>Generar Texto</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="ai_sentiment">
                                            <i class="fas fa-smile"></i>
                                            <span>Análisis de Sentimiento</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="ai_classification">
                                            <i class="fas fa-tags"></i>
                                            <span>Clasificación</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="ai_translation">
                                            <i class="fas fa-language"></i>
                                            <span>Traducción</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Base de Datos -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-database category-icon"></i>
                                        <span class="category-name">Base de Datos</span>
                                        <span class="category-count">4</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="db_connect">
                                            <i class="fas fa-plug"></i>
                                            <span>Conectar Base de Datos</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="db_query">
                                            <i class="fas fa-search"></i>
                                            <span>Ejecutar Consulta</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="db_insert">
                                            <i class="fas fa-plus-circle"></i>
                                            <span>Insertar Datos</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="db_disconnect">
                                            <i class="fas fa-unlink"></i>
                                            <span>Desconectar</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Archivos -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-folder category-icon"></i>
                                        <span class="category-name">Archivos</span>
                                        <span class="category-count">6</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="file_read">
                                            <i class="fas fa-file-alt"></i>
                                            <span>Leer Archivo</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="file_write">
                                            <i class="fas fa-file-edit"></i>
                                            <span>Escribir Archivo</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="file_copy">
                                            <i class="fas fa-copy"></i>
                                            <span>Copiar Archivo</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="file_move">
                                            <i class="fas fa-file-export"></i>
                                            <span>Mover Archivo</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="file_delete">
                                            <i class="fas fa-trash"></i>
                                            <span>Eliminar Archivo</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="file_exists">
                                            <i class="fas fa-question-circle"></i>
                                            <span>Archivo Existe</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Email -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-envelope category-icon"></i>
                                        <span class="category-name">Correo Electrónico</span>
                                        <span class="category-count">3</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="email_send">
                                            <i class="fas fa-paper-plane"></i>
                                            <span>Enviar Email</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="email_read">
                                            <i class="fas fa-envelope-open"></i>
                                            <span>Leer Email</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="email_download_attachment">
                                            <i class="fas fa-paperclip"></i>
                                            <span>Descargar Adjunto</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Control de Flujo -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-code-branch category-icon"></i>
                                        <span class="category-name">Control de Flujo</span>
                                        <span class="category-count">5</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="if_condition">
                                            <i class="fas fa-question"></i>
                                            <span>Si / Condición</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="for_loop">
                                            <i class="fas fa-redo"></i>
                                            <span>Bucle For</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="while_loop">
                                            <i class="fas fa-sync"></i>
                                            <span>Bucle While</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="delay">
                                            <i class="fas fa-clock"></i>
                                            <span>Esperar/Delay</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="try_catch">
                                            <i class="fas fa-shield-alt"></i>
                                            <span>Try/Catch</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Excel -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-file-excel category-icon"></i>
                                        <span class="category-name">Excel</span>
                                        <span class="category-count">3</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="excel_read">
                                            <i class="fas fa-file-excel"></i>
                                            <span>Leer Excel</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="excel_write">
                                            <i class="fas fa-file-edit"></i>
                                            <span>Escribir Excel</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="excel_close">
                                            <i class="fas fa-times-circle"></i>
                                            <span>Cerrar Excel</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: PDF -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-file-pdf category-icon"></i>
                                        <span class="category-name">PDF</span>
                                        <span class="category-count">2</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="pdf_read">
                                            <i class="fas fa-file-pdf"></i>
                                            <span>Leer PDF</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="pdf_create">
                                            <i class="fas fa-file-pdf"></i>
                                            <span>Crear PDF</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: OCR -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-eye category-icon"></i>
                                        <span class="category-name">OCR</span>
                                        <span class="category-count">2</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="ocr_image">
                                            <i class="fas fa-image"></i>
                                            <span>OCR Imagen</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="ocr_pdf">
                                            <i class="fas fa-file-pdf"></i>
                                            <span>OCR PDF</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Variables -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-cube category-icon"></i>
                                        <span class="category-name">Variables</span>
                                        <span class="category-count">2</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="set_variable">
                                            <i class="fas fa-cube"></i>
                                            <span>Establecer Variable</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="get_variable">
                                            <i class="fas fa-cube"></i>
                                            <span>Obtener Variable</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Scripts -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-code category-icon"></i>
                                        <span class="category-name">Scripts</span>
                                        <span class="category-count">3</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="run_javascript">
                                            <i class="fas fa-code"></i>
                                            <span>JavaScript</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="run_python">
                                            <i class="fab fa-python"></i>
                                            <span>Python</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="run_powershell">
                                            <i class="fas fa-terminal"></i>
                                            <span>PowerShell</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: REST Web Services -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-network-wired category-icon"></i>
                                        <span class="category-name">REST Web Services</span>
                                        <span class="category-count">4</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="rest_get">
                                            <i class="fas fa-download"></i>
                                            <span>GET Request</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="rest_post">
                                            <i class="fas fa-upload"></i>
                                            <span>POST Request</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="rest_put">
                                            <i class="fas fa-edit"></i>
                                            <span>PUT Request</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="rest_delete">
                                            <i class="fas fa-trash"></i>
                                            <span>DELETE Request</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: SAP -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-building category-icon"></i>
                                        <span class="category-name">SAP</span>
                                        <span class="category-count">3</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="sap_connect">
                                            <i class="fas fa-plug"></i>
                                            <span>Conectar SAP</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="sap_get_data">
                                            <i class="fas fa-database"></i>
                                            <span>Obtener Datos</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="sap_create_order">
                                            <i class="fas fa-shopping-cart"></i>
                                            <span>Crear Orden</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Microsoft 365 -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fab fa-microsoft category-icon"></i>
                                        <span class="category-name">Microsoft 365</span>
                                        <span class="category-count">4</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="m365_calendar">
                                            <i class="fas fa-calendar"></i>
                                            <span>Calendario</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="m365_excel">
                                            <i class="fas fa-file-excel"></i>
                                            <span>Excel Online</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="m365_onedrive">
                                            <i class="fas fa-cloud"></i>
                                            <span>OneDrive</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="m365_outlook">
                                            <i class="fas fa-envelope"></i>
                                            <span>Outlook</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Mouse & Keyboard -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-mouse category-icon"></i>
                                        <span class="category-name">Mouse & Keyboard</span>
                                        <span class="category-count">4</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="mouse_click">
                                            <i class="fas fa-mouse-pointer"></i>
                                            <span>Click Mouse</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="mouse_move">
                                            <i class="fas fa-arrows-alt"></i>
                                            <span>Mover Mouse</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="keyboard_type">
                                            <i class="fas fa-keyboard"></i>
                                            <span>Teclear</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="keyboard_hotkey">
                                            <i class="fas fa-keyboard"></i>
                                            <span>Tecla Rápida</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Clipboard -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-clipboard category-icon"></i>
                                        <span class="category-name">Clipboard</span>
                                        <span class="category-count">3</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="clipboard_copy">
                                            <i class="fas fa-copy"></i>
                                            <span>Copiar</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="clipboard_paste">
                                            <i class="fas fa-paste"></i>
                                            <span>Pegar</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="clipboard_clear">
                                            <i class="fas fa-eraser"></i>
                                            <span>Limpiar</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Data Table -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-table category-icon"></i>
                                        <span class="category-name">Data Table</span>
                                        <span class="category-count">5</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="dt_create">
                                            <i class="fas fa-plus"></i>
                                            <span>Crear Tabla</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="dt_add_row">
                                            <i class="fas fa-plus-circle"></i>
                                            <span>Agregar Fila</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="dt_get_row">
                                            <i class="fas fa-list-ol"></i>
                                            <span>Obtener Fila</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="dt_filter">
                                            <i class="fas fa-filter"></i>
                                            <span>Filtrar</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="dt_sort">
                                            <i class="fas fa-sort"></i>
                                            <span>Ordenar</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Loop -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-sync category-icon"></i>
                                        <span class="category-name">Loop</span>
                                        <span class="category-count">3</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="loop_for_each">
                                            <i class="fas fa-redo"></i>
                                            <span>For Each</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="loop_while">
                                            <i class="fas fa-sync"></i>
                                            <span>While</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="loop_do_while">
                                            <i class="fas fa-sync-alt"></i>
                                            <span>Do While</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Message Box -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-comment category-icon"></i>
                                        <span class="category-name">Message Box</span>
                                        <span class="category-count">2</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="msgbox_show">
                                            <i class="fas fa-window-maximize"></i>
                                            <span>Mostrar Mensaje</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="msgbox_input">
                                            <i class="fas fa-keyboard"></i>
                                            <span>Solicitar Entrada</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Categoría: Logging -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-chevron-right"></i>
                                        <i class="fas fa-file-alt category-icon"></i>
                                        <span class="category-name">Logging</span>
                                        <span class="category-count">3</span>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="log_message">
                                            <i class="fas fa-pen"></i>
                                            <span>Log Message</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="log_error">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            <span>Log Error</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="log_info">
                                            <i class="fas fa-info-circle"></i>
                                            <span>Log Info</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 💰 Categoría: Finanzas -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-dollar-sign"></i>
                                        <span>Finanzas</span>
                                        <i class="fas fa-chevron-down category-chevron"></i>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="finance_cfdi_validate">
                                            <i class="fas fa-file-invoice"></i>
                                            <span>Validar CFDI SAT</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="finance_bank_reconciliation">
                                            <i class="fas fa-balance-scale"></i>
                                            <span>Conciliación Bancaria</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="finance_pl_automation">
                                            <i class="fas fa-chart-line"></i>
                                            <span>P&L Automation</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="finance_invoice_processing">
                                            <i class="fas fa-receipt"></i>
                                            <span>Procesar Facturas</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="finance_payment_validation">
                                            <i class="fas fa-money-check-alt"></i>
                                            <span>Validar Pagos</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 👥 Categoría: Recursos Humanos -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-users"></i>
                                        <span>Recursos Humanos</span>
                                        <i class="fas fa-chevron-down category-chevron"></i>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="hr_recruitment_ai">
                                            <i class="fas fa-user-tie"></i>
                                            <span>Reclutamiento Inteligente</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="hr_onboarding_digital">
                                            <i class="fas fa-user-plus"></i>
                                            <span>Onboarding Digital</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="hr_cv_screening">
                                            <i class="fas fa-file-alt"></i>
                                            <span>Screening CV con IA</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="hr_interview_scheduler">
                                            <i class="fas fa-calendar-alt"></i>
                                            <span>Agendar Entrevistas</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="hr_payroll_processing">
                                            <i class="fas fa-money-bill-wave"></i>
                                            <span>Procesamiento Nómina</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 🛒 Categoría: Ventas -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-shopping-cart"></i>
                                        <span>Ventas</span>
                                        <i class="fas fa-chevron-down category-chevron"></i>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="sales_order_capture">
                                            <i class="fas fa-cart-plus"></i>
                                            <span>Captura de Pedidos</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="sales_order_tracking">
                                            <i class="fas fa-search-dollar"></i>
                                            <span>Seguimiento Pedidos</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="sales_collection_agent">
                                            <i class="fas fa-phone-volume"></i>
                                            <span>Agente de Cobranza</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="sales_quote_generator">
                                            <i class="fas fa-file-invoice-dollar"></i>
                                            <span>Generar Cotizaciones</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="sales_crm_sync">
                                            <i class="fas fa-sync-alt"></i>
                                            <span>Sincronizar CRM</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 🤖 Categoría: Agentes IA -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-robot"></i>
                                        <span>Agentes IA</span>
                                        <i class="fas fa-chevron-down category-chevron"></i>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="agent_customer_service">
                                            <i class="fas fa-headset"></i>
                                            <span>Atención al Cliente</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="agent_it_support">
                                            <i class="fas fa-laptop-medical"></i>
                                            <span>Mesa de Ayuda TI</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="agent_collection">
                                            <i class="fas fa-comments-dollar"></i>
                                            <span>Agente de Cobranza</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="agent_cfo_assistant">
                                            <i class="fas fa-chart-pie"></i>
                                            <span>CFO Assistant</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="agent_sales_assistant">
                                            <i class="fas fa-user-tie"></i>
                                            <span>Asistente de Ventas</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 🔌 Categoría: Conectores -->
                                <div class="action-category expanded">
                                    <div class="category-header" onclick="WorkflowStudio.toggleCategory(this)">
                                        <i class="fas fa-plug"></i>
                                        <span>Conectores</span>
                                        <i class="fas fa-chevron-down category-chevron"></i>
                                    </div>
                                    <div class="category-items">
                                        <div class="action-item" draggable="true" data-action="connector_rest_api">
                                            <i class="fas fa-cloud"></i>
                                            <span>REST API</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="connector_openapi">
                                            <i class="fas fa-book"></i>
                                            <span>OpenAPI</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="connector_postgresql">
                                            <i class="fas fa-database"></i>
                                            <span>PostgreSQL</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="connector_mysql">
                                            <i class="fas fa-database"></i>
                                            <span>MySQL</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="connector_mongodb">
                                            <i class="fas fa-leaf"></i>
                                            <span>MongoDB</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="connector_s3">
                                            <i class="fab fa-aws"></i>
                                            <span>Amazon S3</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="connector_whatsapp">
                                            <i class="fab fa-whatsapp"></i>
                                            <span>WhatsApp Business</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="connector_slack">
                                            <i class="fab fa-slack"></i>
                                            <span>Slack</span>
                                        </div>
                                        <div class="action-item" draggable="true" data-action="connector_teams">
                                            <i class="fab fa-microsoft"></i>
                                            <span>Microsoft Teams</span>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- Panel Central - Canvas -->
                        <div class="studio-center-panel">
                            <div class="canvas-toolbar">
                                <button class="btn btn-sm btn-primary" onclick="WorkflowEditor.newWorkflow()">
                                    <i class="fas fa-file"></i> Nuevo
                                </button>
                                <button class="btn btn-sm btn-success" onclick="WorkflowEditor.saveWorkflow()">
                                    <i class="fas fa-save"></i> Guardar
                                </button>
                                <button class="btn btn-sm btn-secondary" onclick="WorkflowEditor.importWorkflow()">
                                    <i class="fas fa-file-import"></i> Importar
                                </button>
                                <button class="btn btn-sm btn-secondary" onclick="WorkflowEditor.exportWorkflow()">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                                <div style="border-left: 1px solid var(--border-color); height: 24px; margin: 0 0.5rem;"></div>
                                <button class="btn btn-sm btn-warning" onclick="RPAMigrator.prototype.openMigrationModal()">
                                    <i class="fas fa-exchange-alt"></i> Migrar
                                </button>
                                <button class="btn btn-sm" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;" onclick="AIWizard.open()">
                                    <i class="fas fa-robot"></i> IA
                                </button>
                                <div style="margin-left: auto;">
                                    <button class="btn btn-sm btn-secondary" onclick="WorkflowEditor.toggleView()">
                                        <i class="fas fa-sitemap"></i> Vista
                                    </button>
                                </div>
                            </div>

                            <div class="canvas-container">
                                <div class="workflow-canvas" id="workflowCanvas">
                                    <div class="workflow-canvas-empty" id="canvasEmptyState">
                                        <i class="fas fa-project-diagram"></i>
                                        <p>Arrastra acciones aquí para construir tu workflow</p>
                                        <small>O usa el generador con IA para crear workflows automáticamente</small>
                                    </div>
                                    <div id="workflowSteps" style="display: none;">
                                        <!-- Los steps se añaden aquí dinámicamente -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Panel Derecho - Propiedades -->
                        <div class="studio-right-panel" id="rightPanel">
                            <div class="panel-header">
                                <h3>
                                    <i class="fas fa-cog"></i>
                                    Propiedades
                                </h3>
                                <button class="panel-collapse-btn" onclick="WorkflowStudio.toggleRightPanel()">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>

                            <div class="properties-content" id="propertiesContent">
                                <div style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                                    <i class="fas fa-mouse-pointer" style="font-size: 3rem; opacity: 0.3; margin-bottom: 1rem;"></i>
                                    <p>Selecciona una acción para ver sus propiedades</p>
                                </div>
                            </div>
                        </div>

                        <!-- Footer -->
                        <div class="studio-footer">
                            <div class="studio-footer-left">
                                <div class="studio-footer-item">
                                    <i class="fas fa-layer-group"></i>
                                    <span id="stepsCount">0 pasos</span>
                                </div>
                                <div class="studio-footer-item">
                                    <i class="fas fa-clock"></i>
                                    <span>Última modificación: Ahora</span>
                                </div>
                            </div>
                            <div class="studio-footer-right">
                                <div class="studio-footer-item" id="connectionStatus">
                                    <i class="fas fa-circle" style="color: #10b981;"></i>
                                    <span>Conectado</span>
                                </div>
                                <div class="studio-footer-item">
                                    <span>Alqvimia Studio v1.0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Executor View -->
                <div class="view" id="executor-view">
                    <div class="view-header">
                        <h2><i class="fas fa-play-circle"></i> Ejecutor de Workflows</h2>
                        <p>Ejecuta y monitorea tus workflows de automatización</p>
                    </div>

                    <div class="executor-panel">
                        <div class="execution-controls">
                            <button class="btn btn-success btn-lg" id="executeWorkflow">
                                <i class="fas fa-play"></i> Ejecutar Workflow Actual
                            </button>
                            <button class="btn btn-danger btn-lg" id="stopExecution" disabled>
                                <i class="fas fa-stop"></i> Detener Ejecución
                            </button>
                        </div>

                        <div class="execution-monitor">
                            <h3>Monitor de Ejecución</h3>
                            <div class="monitor-display" id="executionMonitor">
                                <div class="monitor-idle">
                                    <i class="fas fa-robot"></i>
                                    <p>Esperando ejecución...</p>
                                </div>
                            </div>

                            <div class="progress-section" id="progressSection" style="display:none;">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progressFill"></div>
                                </div>
                                <div class="progress-text" id="progressText">0%</div>
                            </div>
                        </div>

                        <div class="execution-log">
                            <h3>Log de Ejecución</h3>
                            <div class="log-container" id="executionLog">
                                <div class="log-entry log-info">
                                    <span class="log-time">[00:00:00]</span>
                                    <span class="log-message">Sistema listo</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Library View -->
                <div class="view" id="library-view">
                    <div class="view-header">
                        <h2><i class="fas fa-folder-open"></i> Biblioteca de Workflows</h2>
                        <p>Gestiona todos tus workflows guardados</p>
                    </div>

                    <div class="library-content">
                        <div class="library-toolbar">
                            <input type="text" id="searchWorkflows" placeholder="Buscar workflows...">
                            <button class="btn btn-primary" id="refreshLibrary">
                                <i class="fas fa-sync"></i> Actualizar
                            </button>
                        </div>

                        <div class="workflows-grid" id="workflowsGrid">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>No hay workflows guardados</p>
                                <small>Crea tu primer workflow para comenzar</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Dashboard View -->
                <div class="view" id="ai-dashboard-view">
                    <div class="view-header" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; padding: 2rem; border-radius: 8px; margin-bottom: 2rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h2><i class="fas fa-brain"></i> Document Automation Agent - IA Dashboard</h2>
                                <p style="opacity: 0.9; margin: 0.5rem 0 0 0;">Automatización inteligente de documentos con IA</p>
                            </div>
                            <button class="btn btn-light" onclick="AIConfigManager.openConfigWizard()" style="background: white; color: #6366f1; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                                <i class="fas fa-cog"></i> Configurar IA/OCR
                            </button>
                        </div>
                    </div>

                    <!-- Estadísticas Principales -->
                    <div class="ai-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                        <div class="stat-card" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); padding: 1.5rem; border-radius: 8px; border: 1px solid #334155;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="background: #6366f1; width: 50px; height: 50px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-file-invoice" style="font-size: 1.5rem; color: white;"></i>
                                </div>
                                <div>
                                    <div style="font-size: 2rem; font-weight: bold; color: #e2e8f0;" id="totalDocumentsProcessed">0</div>
                                    <div style="color: #94a3b8; font-size: 0.9rem;">Documentos Procesados</div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); padding: 1.5rem; border-radius: 8px; border: 1px solid #334155;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="background: #10b981; width: 50px; height: 50px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-check-circle" style="font-size: 1.5rem; color: white;"></i>
                                </div>
                                <div>
                                    <div style="font-size: 2rem; font-weight: bold; color: #e2e8f0;" id="averageAccuracy">0%</div>
                                    <div style="color: #94a3b8; font-size: 0.9rem;">Precisión Promedio</div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); padding: 1.5rem; border-radius: 8px; border: 1px solid #334155;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="background: #8b5cf6; width: 50px; height: 50px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-bolt" style="font-size: 1.5rem; color: white;"></i>
                                </div>
                                <div>
                                    <div style="font-size: 2rem; font-weight: bold; color: #e2e8f0;" id="totalWorkflowsGenerated">0</div>
                                    <div style="color: #94a3b8; font-size: 0.9rem;">Workflows Generados</div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); padding: 1.5rem; border-radius: 8px; border: 1px solid #334155;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="background: #f59e0b; width: 50px; height: 50px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-clock" style="font-size: 1.5rem; color: white;"></i>
                                </div>
                                <div>
                                    <div style="font-size: 2rem; font-weight: bold; color: #e2e8f0;" id="timeSaved">0h</div>
                                    <div style="color: #94a3b8; font-size: 0.9rem;">Tiempo Ahorrado</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Acciones Rápidas -->
                    <div style="margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem;"><i class="fas fa-rocket"></i> Acciones Rápidas</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                            <button class="ai-action-card" onclick="AIWizard.open()" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); border: none; padding: 1.5rem; border-radius: 8px; cursor: pointer; text-align: left; color: white; transition: transform 0.2s;">
                                <i class="fas fa-robot" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
                                <h4 style="margin: 0.5rem 0;">Generar Workflow con IA</h4>
                                <p style="opacity: 0.9; margin: 0; font-size: 0.9rem;">Usa la IA para crear workflows automáticamente</p>
                            </button>

                            <button class="ai-action-card" onclick="AIDashboard.trainModel()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none; padding: 1.5rem; border-radius: 8px; cursor: pointer; text-align: left; color: white; transition: transform 0.2s;">
                                <i class="fas fa-graduation-cap" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
                                <h4 style="margin: 0.5rem 0;">Entrenar Modelo</h4>
                                <p style="opacity: 0.9; margin: 0; font-size: 0.9rem;">Mejora la precisión con documentos de ejemplo</p>
                            </button>

                            <button class="ai-action-card" onclick="AIDashboard.batchProcess()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border: none; padding: 1.5rem; border-radius: 8px; cursor: pointer; text-align: left; color: white; transition: transform 0.2s;">
                                <i class="fas fa-layer-group" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
                                <h4 style="margin: 0.5rem 0;">Procesamiento por Lotes</h4>
                                <p style="opacity: 0.9; margin: 0; font-size: 0.9rem;">Procesa múltiples documentos a la vez</p>
                            </button>
                        </div>
                    </div>

                    <!-- Historial de Procesamiento -->
                    <div>
                        <h3 style="margin-bottom: 1rem;"><i class="fas fa-history"></i> Historial de Procesamiento</h3>
                        <div style="background: #1e293b; border-radius: 8px; overflow: hidden; border: 1px solid #334155;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead style="background: #0f172a;">
                                    <tr>
                                        <th style="padding: 1rem; text-align: left; color: #cbd5e1; font-weight: 600;">Documento</th>
                                        <th style="padding: 1rem; text-align: left; color: #cbd5e1; font-weight: 600;">Tipo</th>
                                        <th style="padding: 1rem; text-align: left; color: #cbd5e1; font-weight: 600;">Campos Extraídos</th>
                                        <th style="padding: 1rem; text-align: left; color: #cbd5e1; font-weight: 600;">Precisión</th>
                                        <th style="padding: 1rem; text-align: left; color: #cbd5e1; font-weight: 600;">Fecha</th>
                                        <th style="padding: 1rem; text-align: left; color: #cbd5e1; font-weight: 600;">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="processingHistory">
                                    <tr>
                                        <td colspan="6" style="padding: 3rem; text-align: center; color: #64748b;">
                                            <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                                            <p>No hay documentos procesados aún</p>
                                            <button class="btn btn-primary" onclick="AIWizard.open()" style="margin-top: 1rem;">
                                                <i class="fas fa-robot"></i> Procesar Primer Documento
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Omnichannel View -->
                <div class="view" id="omnichannel-view">
                    <div class="view-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 2rem; border-radius: 8px; margin-bottom: 2rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h2><i class="fas fa-comments"></i> Omnicanalidad - WhatsApp & Telegram</h2>
                                <p style="opacity: 0.9; margin: 0.5rem 0 0 0;">Sistema de chatbots y mensajería multicanal</p>
                            </div>
                            <div style="display: flex; gap: 1rem;">
                                <button class="btn btn-light" onclick="OmnichannelUI.initializeSystem()" style="background: white; color: #10b981; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer;">
                                    <i class="fas fa-power-off"></i> Inicializar Sistema
                                </button>
                                <button class="btn btn-light" onclick="OmnichannelUI.refreshStatus()" style="background: white; color: #10b981; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer;">
                                    <i class="fas fa-sync"></i> Actualizar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Estado del Sistema -->
                    <div id="omnichannelStatus" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                        <!-- WhatsApp Status Card -->
                        <div class="stat-card" style="background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); padding: 1.5rem; border-radius: 8px; color: white;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <i class="fab fa-whatsapp" style="font-size: 2.5rem;"></i>
                                <div style="flex: 1;">
                                    <h3 style="margin: 0;">WhatsApp</h3>
                                    <p id="whatsappStatus" style="margin: 0.5rem 0 0 0; opacity: 0.9;">Desconectado</p>
                                </div>
                            </div>
                            <div id="whatsappPhone" style="font-size: 0.9rem; opacity: 0.9;"></div>
                            <button onclick="OmnichannelUI.showWhatsAppQR()" class="btn" style="margin-top: 1rem; background: white; color: #25D366; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; width: 100%;">
                                <i class="fas fa-qrcode"></i> Ver QR Code
                            </button>
                        </div>

                        <!-- Telegram Status Card -->
                        <div class="stat-card" style="background: linear-gradient(135deg, #0088cc 0%, #0066cc 100%); padding: 1.5rem; border-radius: 8px; color: white;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <i class="fab fa-telegram" style="font-size: 2.5rem;"></i>
                                <div style="flex: 1;">
                                    <h3 style="margin: 0;">Telegram</h3>
                                    <p id="telegramStatus" style="margin: 0.5rem 0 0 0; opacity: 0.9;">Desconectado</p>
                                </div>
                            </div>
                            <div id="telegramUsername" style="font-size: 0.9rem; opacity: 0.9;"></div>
                            <button onclick="OmnichannelUI.openTelegramConfig()" class="btn" style="margin-top: 1rem; background: white; color: #0088cc; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; width: 100%;">
                                <i class="fas fa-cog"></i> Configurar Bot
                            </button>
                        </div>

                        <!-- Estadísticas -->
                        <div class="stat-card" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); padding: 1.5rem; border-radius: 8px; color: white;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <i class="fas fa-chart-line" style="font-size: 2.5rem;"></i>
                                <div>
                                    <h3 style="margin: 0 0 0.5rem 0;">Estadísticas</h3>
                                    <p style="margin: 0.25rem 0; opacity: 0.9;">Conversaciones: <span id="totalConversations">0</span></p>
                                    <p style="margin: 0.25rem 0; opacity: 0.9;">Mensajes en cola: <span id="queuedMessages">0</span></p>
                                    <p style="margin: 0.25rem 0; opacity: 0.9;">Templates: <span id="totalTemplates">0</span></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="tabs" style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 2px solid #334155;">
                        <button class="tab-button active" onclick="OmnichannelUI.switchTab('messages')" data-tab="messages" style="padding: 0.75rem 1.5rem; background: none; border: none; border-bottom: 2px solid #10b981; color: #10b981; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-comment-dots"></i> Enviar Mensajes
                        </button>
                        <button class="tab-button" onclick="OmnichannelUI.switchTab('conversations')" data-tab="conversations" style="padding: 0.75rem 1.5rem; background: none; border: none; border-bottom: 2px solid transparent; color: #94a3b8; cursor: pointer;">
                            <i class="fas fa-comments"></i> Conversaciones
                        </button>
                        <button class="tab-button" onclick="OmnichannelUI.switchTab('templates')" data-tab="templates" style="padding: 0.75rem 1.5rem; background: none; border: none; border-bottom: 2px solid transparent; color: #94a3b8; cursor: pointer;">
                            <i class="fas fa-file-alt"></i> Templates
                        </button>
                        <button class="tab-button" onclick="OmnichannelUI.switchTab('config')" data-tab="config" style="padding: 0.75rem 1.5rem; background: none; border: none; border-bottom: 2px solid transparent; color: #94a3b8; cursor: pointer;">
                            <i class="fas fa-cog"></i> Configuración
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div class="tab-content">
                        <!-- Messages Tab -->
                        <div id="messages-tab" class="tab-pane active">
                            <div style="background: #1e293b; padding: 2rem; border-radius: 8px; border: 1px solid #334155;">
                                <h3 style="margin-bottom: 1.5rem;"><i class="fas fa-paper-plane"></i> Enviar Mensaje</h3>

                                <div style="display: grid; gap: 1rem;">
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; color: #cbd5e1;">Canal</label>
                                        <select id="messageChannel" style="width: 100%; padding: 0.75rem; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: white;">
                                            <option value="whatsapp">📱 WhatsApp</option>
                                            <option value="telegram">🤖 Telegram</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; color: #cbd5e1;">Destinatario</label>
                                        <input type="text" id="messageRecipient" placeholder="5215512345678 o 123456789" style="width: 100%; padding: 0.75rem; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: white;">
                                        <small style="color: #94a3b8;">WhatsApp: número con código de país | Telegram: chat ID</small>
                                    </div>

                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; color: #cbd5e1;">Mensaje</label>
                                        <textarea id="messageText" rows="4" placeholder="Escribe tu mensaje aquí..." style="width: 100%; padding: 0.75rem; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: white; resize: vertical;"></textarea>
                                    </div>

                                    <button onclick="OmnichannelUI.sendMessage()" class="btn btn-primary" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none; padding: 1rem; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">
                                        <i class="fas fa-paper-plane"></i> Enviar Mensaje
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Conversations Tab -->
                        <div id="conversations-tab" class="tab-pane" style="display: none;">
                            <div style="background: #1e293b; padding: 2rem; border-radius: 8px; border: 1px solid #334155;">
                                <h3 style="margin-bottom: 1.5rem;"><i class="fas fa-comments"></i> Historial de Conversaciones</h3>
                                <div id="conversationsList"></div>
                            </div>
                        </div>

                        <!-- Templates Tab -->
                        <div id="templates-tab" class="tab-pane" style="display: none;">
                            <div style="background: #1e293b; padding: 2rem; border-radius: 8px; border: 1px solid #334155;">
                                <h3 style="margin-bottom: 1.5rem;"><i class="fas fa-file-alt"></i> Templates de Mensajes</h3>

                                <div style="display: grid; gap: 1rem; margin-bottom: 2rem;">
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; color: #cbd5e1;">Nombre del Template</label>
                                        <input type="text" id="templateName" placeholder="bienvenida" style="width: 100%; padding: 0.75rem; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: white;">
                                    </div>

                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; color: #cbd5e1;">Mensaje (usa {{variable}} para variables)</label>
                                        <textarea id="templateText" rows="4" placeholder="Hola {{nombre}}! Bienvenido a {{empresa}}" style="width: 100%; padding: 0.75rem; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: white; resize: vertical;"></textarea>
                                    </div>

                                    <button onclick="OmnichannelUI.createTemplate()" class="btn btn-primary" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); border: none; padding: 1rem; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">
                                        <i class="fas fa-plus"></i> Crear Template
                                    </button>
                                </div>

                                <div id="templatesList"></div>
                            </div>
                        </div>

                        <!-- Config Tab -->
                        <div id="config-tab" class="tab-pane" style="display: none;">
                            <div style="background: #1e293b; padding: 2rem; border-radius: 8px; border: 1px solid #334155;">
                                <h3 style="margin-bottom: 1.5rem;"><i class="fas fa-cog"></i> Configuración del Sistema</h3>

                                <div style="display: grid; gap: 2rem;">
                                    <!-- WhatsApp Config -->
                                    <div>
                                        <h4 style="color: #25D366; margin-bottom: 1rem;"><i class="fab fa-whatsapp"></i> WhatsApp</h4>
                                        <div style="display: grid; gap: 1rem;">
                                            <label style="display: flex; align-items: center; gap: 0.5rem; color: #cbd5e1;">
                                                <input type="checkbox" id="whatsappEnabled" checked>
                                                <span>Habilitar WhatsApp</span>
                                            </label>

                                            <div>
                                                <label style="display: block; margin-bottom: 0.5rem; color: #cbd5e1;">Proveedor</label>
                                                <select id="whatsappProvider" style="width: 100%; padding: 0.75rem; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: white;">
                                                    <option value="whatsapp-web.js">whatsapp-web.js (Gratis)</option>
                                                    <option value="twilio">Twilio (API)</option>
                                                </select>
                                            </div>

                                            <label style="display: flex; align-items: center; gap: 0.5rem; color: #cbd5e1;">
                                                <input type="checkbox" id="whatsappAutoReply">
                                                <span>Auto-respuesta automática</span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Telegram Config -->
                                    <div>
                                        <h4 style="color: #0088cc; margin-bottom: 1rem;"><i class="fab fa-telegram"></i> Telegram</h4>
                                        <div style="display: grid; gap: 1rem;">
                                            <label style="display: flex; align-items: center; gap: 0.5rem; color: #cbd5e1;">
                                                <input type="checkbox" id="telegramEnabled">
                                                <span>Habilitar Telegram</span>
                                            </label>

                                            <div>
                                                <label style="display: block; margin-bottom: 0.5rem; color: #cbd5e1;">Token del Bot</label>
                                                <input type="text" id="telegramToken" placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz" style="width: 100%; padding: 0.75rem; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: white;">
                                                <small style="color: #94a3b8;">Obtén tu token de @BotFather en Telegram</small>
                                            </div>
                                        </div>
                                    </div>

                                    <button onclick="OmnichannelUI.saveConfig()" class="btn btn-primary" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none; padding: 1rem; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">
                                        <i class="fas fa-save"></i> Guardar y Reiniciar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- QR Modal -->
                    <div id="qrModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
                        <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 500px; text-align: center;">
                            <h3 style="margin-bottom: 1rem; color: #1e293b;">Escanea este QR con WhatsApp</h3>
                            <div id="qrCodeContainer" style="margin: 1.5rem 0;"></div>
                            <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 1rem;">
                                Abre WhatsApp → Configuración → Dispositivos vinculados → Vincular dispositivo
                            </p>
                            <button onclick="OmnichannelUI.closeQRModal()" style="background: #10b981; color: white; border: none; padding: 0.75rem 2rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                Cerrar
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal para configuración de acciones -->
    <div class="modal" id="actionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Configurar Acción</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Contenido dinámico -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAction">Cancelar</button>
                <button class="btn btn-primary" id="confirmAction">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modal para seleccionar formato de exportación -->
    <div class="modal" id="exportFormatModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-file-export"></i> Guardar Workflow Como...</h3>
                <button class="modal-close" onclick="WorkflowExporter.closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">
                        <i class="fas fa-file-signature"></i> Formato de Salida:
                    </label>
                    <select id="exportFormat" class="form-control" style="width: 100%; padding: 0.75rem; font-size: 1rem;">
                        <option value="">-- Selecciona un formato --</option>
                        <option value="json">📄 JSON (JavaScript Object Notation)</option>
                        <option value="mermaid">🔷 Mermaid Chart (Diagrama de flujo)</option>
                        <option value="markdown">📝 Markdown (.md)</option>
                        <option value="word">📘 Word (.docx)</option>
                        <option value="pdf">📕 PDF (Portable Document Format)</option>
                    </select>
                </div>

                <div id="formatDescription" style="padding: 1rem; background: rgba(37, 99, 235, 0.1); border-left: 3px solid #2563eb; border-radius: 4px; margin-bottom: 1.5rem; display: none;">
                    <p id="formatDescriptionText" style="margin: 0; font-size: 0.9rem; color: #cbd5e1;"></p>
                </div>

                <div id="componentsAnalysis" style="display: none; margin-top: 1.5rem;">
                    <h4 style="margin-bottom: 1rem; color: #10b981;">
                        <i class="fas fa-check-circle"></i> Análisis de Componentes
                    </h4>
                    <div id="componentsAnalysisContent"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="WorkflowExporter.closeModal()">Cancelar</button>
                <button class="btn btn-success" id="confirmExport" onclick="WorkflowExporter.selectFolder()" disabled>
                    <i class="fas fa-folder-open"></i> Seleccionar Carpeta y Guardar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Importación Inteligente de Workflows -->
    <div id="importWorkflowModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                <h2><i class="fas fa-file-import"></i> Importación Inteligente de Workflow</h2>
                <button class="close-modal" onclick="WorkflowImporter.closeImportModal()">&times;</button>
            </div>

            <div class="modal-body">
                <!-- Paso 1: Selección de archivo -->
                <div class="import-section">
                    <h3><i class="fas fa-upload"></i> 1. Seleccionar Archivo</h3>
                    <div style="display: flex; gap: 1rem; align-items: center; margin-top: 1rem;">
                        <div style="flex: 1;">
                            <label for="importFormatSelect" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                Formato del archivo:
                            </label>
                            <select id="importFormatSelect" class="form-control">
                                <option value="json">📄 JSON</option>
                                <option value="markdown">📝 Markdown (.md)</option>
                                <option value="mermaid">🔷 Mermaid Chart</option>
                            </select>
                        </div>
                        <div style="flex: 2;">
                            <label for="importFileInput" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                Archivo:
                            </label>
                            <input
                                type="file"
                                id="importFileInput"
                                class="form-control"
                                accept=".json,.md,.txt"
                                onchange="WorkflowImporter.handleFileSelect(event)"
                            >
                        </div>
                    </div>
                </div>

                <!-- Paso 2: Análisis de Secuencia -->
                <div id="importAnalysisSection" class="import-section" style="display: none;">
                    <h3><i class="fas fa-search"></i> 2. Análisis de Secuencia</h3>
                    <div id="importAnalysisSteps"></div>
                    <div id="importAnalysisComponents" style="margin-top: 1rem;"></div>
                    <div id="importAnalysisCategories" style="margin-top: 1rem;"></div>
                    <div id="importAnalysisValidation" style="margin-top: 1rem;"></div>

                    <!-- Botón para generar componentes faltantes -->
                    <button
                        id="importGenerateMissingBtn"
                        class="btn btn-primary"
                        style="display: none; margin-top: 1rem; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);"
                    >
                        <i class="fas fa-magic"></i> Generar Componentes Faltantes con IA
                    </button>
                </div>

                <!-- Paso 3: Progreso de Generación -->
                <div id="importProgressSection" class="import-section" style="display: none;">
                    <h3><i class="fas fa-cog fa-spin"></i> 3. Generando Componentes...</h3>
                    <div class="progress-container" style="margin-top: 1rem;">
                        <div class="progress-bar-container" style="background: #e5e7eb; border-radius: 8px; height: 30px; overflow: hidden;">
                            <div
                                id="importProgressBar"
                                style="background: linear-gradient(90deg, #10b981 0%, #059669 100%); height: 100%; width: 0%; transition: width 0.3s; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;"
                            ></div>
                        </div>
                        <div id="importProgressText" style="margin-top: 0.5rem; text-align: center; font-weight: 500;"></div>
                        <div id="importProgressComponent" style="margin-top: 0.5rem; text-align: center; color: #6b7280; font-style: italic;"></div>
                    </div>
                </div>

                <!-- Paso 4: Resultado y Resumen -->
                <div id="importResultSection" class="import-section" style="display: none;">
                    <h3><i class="fas fa-check-circle"></i> 4. Resumen del Workflow</h3>

                    <!-- Resumen General -->
                    <div id="importGeneralSummary" style="margin-top: 1rem;"></div>

                    <!-- Tabs para Diagrama y Listado -->
                    <div style="margin-top: 1.5rem;">
                        <div class="result-tabs" style="display: flex; gap: 1rem; border-bottom: 2px solid #e5e7eb;">
                            <button
                                class="tab-btn active"
                                onclick="WorkflowImporter.showResultTab('diagram')"
                                style="padding: 0.75rem 1.5rem; border: none; background: none; cursor: pointer; font-weight: 500; border-bottom: 3px solid #3b82f6;"
                            >
                                <i class="fas fa-project-diagram"></i> Vista Diagrama
                            </button>
                            <button
                                class="tab-btn"
                                onclick="WorkflowImporter.showResultTab('list')"
                                style="padding: 0.75rem 1.5rem; border: none; background: none; cursor: pointer; font-weight: 500; border-bottom: 3px solid transparent;"
                            >
                                <i class="fas fa-list"></i> Vista Listado
                            </button>
                        </div>

                        <div class="result-content" style="margin-top: 1.5rem;">
                            <div id="importDiagramView" class="result-view active"></div>
                            <div id="importStepListView" class="result-view" style="display: none;"></div>
                        </div>
                    </div>

                    <!-- Botón para guardar workflow -->
                    <button
                        id="importSaveWorkflowBtn"
                        class="btn btn-success"
                        style="display: none; margin-top: 1.5rem; width: 100%; padding: 1rem; font-size: 1.1rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%);"
                    >
                        <i class="fas fa-save"></i> Guardar Workflow Importado
                    </button>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="WorkflowImporter.closeImportModal()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Migración desde UiPath -->
    <div id="migrationModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                <h2><i class="fas fa-exchange-alt"></i> <span id="migrationModalTitle">Migrar desde otra plataforma</span></h2>
                <button class="close-modal" id="closeMigrationModalBtn">&times;</button>
            </div>

            <div class="modal-body">
                <!-- Selección de plataforma -->
                <div class="migration-platform-selection" id="platformSelection">
                    <h3>🎯 Selecciona la plataforma de origen</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem;">
                        <div class="platform-card" id="platformUiPath" data-platform="uipath" style="cursor: pointer; border: 2px solid var(--border-color); border-radius: 8px; padding: 1.5rem; text-align: center; transition: all 0.2s; background: rgba(30, 41, 59, 0.5);">
                            <div style="font-size: 3rem; margin-bottom: 0.5rem;">🤖</div>
                            <h4 style="margin-bottom: 0.25rem; font-size: 1.1rem; color: #fff; font-weight: 600;">UiPath</h4>
                            <p style="color: #94a3b8; font-size: 0.85rem;">Archivos .xaml</p>
                        </div>
                        <div class="platform-card" id="platformAA" data-platform="automationanywhere" style="cursor: pointer; border: 2px solid var(--border-color); border-radius: 8px; padding: 1.5rem; text-align: center; transition: all 0.2s; background: rgba(30, 41, 59, 0.5);">
                            <div style="font-size: 3rem; margin-bottom: 0.5rem;">🔶</div>
                            <h4 style="margin-bottom: 0.25rem; font-size: 1.1rem; color: #fff; font-weight: 600;">Automation Anywhere</h4>
                            <p style="color: #94a3b8; font-size: 0.85rem;">Archivos .atmx</p>
                        </div>
                        <div class="platform-card" id="platformBluePrism" data-platform="blueprism" style="cursor: pointer; border: 2px solid var(--border-color); border-radius: 8px; padding: 1.5rem; text-align: center; transition: all 0.2s; background: rgba(30, 41, 59, 0.5);">
                            <div style="font-size: 3rem; margin-bottom: 0.5rem;">💠</div>
                            <h4 style="margin-bottom: 0.25rem; font-size: 1.1rem; color: #fff; font-weight: 600;">Blue Prism</h4>
                            <p style="color: #94a3b8; font-size: 0.85rem;">Archivos .bprelease</p>
                        </div>
                        <div class="platform-card" id="platformRocket" data-platform="power" style="cursor: pointer; border: 2px solid var(--border-color); border-radius: 8px; padding: 1.5rem; text-align: center; transition: all 0.2s; background: rgba(30, 41, 59, 0.5);">
                            <div style="font-size: 3rem; margin-bottom: 0.5rem;">⚡</div>
                            <h4 style="margin-bottom: 0.25rem; font-size: 1.1rem; color: #fff; font-weight: 600;">Power Automate</h4>
                            <p style="color: #94a3b8; font-size: 0.85rem;">Archivos .json</p>
                        </div>
                        <div class="platform-card" id="platformPython" data-platform="python" style="cursor: pointer; border: 2px solid var(--border-color); border-radius: 8px; padding: 1.5rem; text-align: center; transition: all 0.2s; background: rgba(30, 41, 59, 0.5);">
                            <div style="font-size: 3rem; margin-bottom: 0.5rem;">🐍</div>
                            <h4 style="margin-bottom: 0.25rem; font-size: 1.1rem; color: #fff; font-weight: 600;">Python / Selenium</h4>
                            <p style="color: #94a3b8; font-size: 0.85rem;">Archivos .py</p>
                        </div>
                        <div class="platform-card" id="platformJson" data-platform="json" style="cursor: pointer; border: 2px solid var(--border-color); border-radius: 8px; padding: 1.5rem; text-align: center; transition: all 0.2s; background: rgba(30, 41, 59, 0.5);">
                            <div style="font-size: 3rem; margin-bottom: 0.5rem;">📄</div>
                            <h4 style="margin-bottom: 0.25rem; font-size: 1.1rem; color: #fff; font-weight: 600;">JSON / XML</h4>
                            <p style="color: #94a3b8; font-size: 0.85rem;">Formato genérico</p>
                        </div>
                    </div>
                </div>

                <!-- Selector de carpeta (oculto inicialmente) -->
                <div class="migration-folder-selector" id="folderSelector" style="display: none; margin-top: 2rem;">
                    <h3>📁 Selecciona la carpeta del proyecto</h3>
                    <div style="margin-top: 1rem;">
                        <input type="file" id="folderInput" webkitdirectory directory multiple style="display: none;">
                        <button class="btn btn-primary" id="selectFolderBtn" style="width: 100%; padding: 1.5rem; font-size: 1.1rem;">
                            <i class="fas fa-folder-open"></i> Seleccionar Carpeta del Proyecto
                        </button>
                        <div id="selectedFolderPath" style="margin-top: 1rem; padding: 1rem; background: rgba(37, 99, 235, 0.1); border: 1px solid var(--primary-color); border-radius: 6px; display: none;">
                            <strong>📂 Carpeta seleccionada:</strong>
                            <div id="folderPathText" style="margin-top: 0.5rem; font-family: 'Courier New', monospace; color: var(--text-secondary);"></div>
                            <button class="btn btn-success" id="confirmFolderBtn" style="margin-top: 1rem; width: 100%;">
                                <i class="fas fa-check"></i> Confirmar y Analizar
                            </button>
                        </div>
                    </div>
                    <button class="btn btn-secondary" id="backToPlatformsBtn" style="margin-top: 1rem;">
                        <i class="fas fa-arrow-left"></i> Volver a Plataformas
                    </button>
                </div>

                <!-- Análisis del proyecto -->
                <div id="migrationAnalysisSection" style="display: none; margin-top: 2rem;">
                    <h3><i class="fas fa-search"></i> Análisis del Proyecto</h3>
                    <div id="migrationProjectInfo"></div>
                </div>

                <!-- Mapeo de actividades -->
                <div id="migrationMappingSection" style="display: none; margin-top: 2rem;">
                    <h3><i class="fas fa-exchange-alt"></i> Mapeo de Actividades</h3>
                    <div id="migrationMappingStats"></div>
                    <div id="migrationWorkflowsList" style="margin-top: 1.5rem;"></div>
                </div>

                <!-- Resultado -->
                <div id="migrationResultSection" style="display: none; margin-top: 2rem;">
                    <div id="migrationWorkflowPreview"></div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeMigrationFooterBtn">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- ⚡ OPTIMIZACIÓN DE CARGA - Solo lo esencial primero -->

    <!-- Critical: Socket.IO debe cargar primero -->
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>

    <!-- Critical: Lazy loader para carga inteligente -->
    <script src="js/lazy-loader.js"></script>

    <!-- Critical: app.js maneja la lógica principal (navegación, conexión) -->
    <script src="js/app.js"></script>

    <!-- Critical: Solo workflow-studio para la vista principal -->
    <script src="js/workflow-studio.js"></script>

    <!-- Backup inline script para garantizar drag & drop -->
    <script>
    // ⚡ BACKUP DRAG & DROP - Garantiza inicialización
    (function() {
        function ensureDragDrop() {
            // Esperar a que WorkflowStudio esté disponible
            if (typeof WorkflowStudio === 'undefined') {
                console.log('⏳ Esperando a WorkflowStudio...');
                setTimeout(ensureDragDrop, 100);
                return;
            }

            // Verificar si ya se inicializó
            if (WorkflowStudio._dragDropInitialized) {
                console.log('✅ Drag & Drop ya inicializado');
                return;
            }

            // Verificar que estamos en la vista de workflows
            const studioElement = document.getElementById('workflowStudio');
            if (!studioElement) {
                console.log('⏭️ No estamos en vista de workflows');
                return;
            }

            // Esperar un momento para que el DOM esté listo
            setTimeout(() => {
                const actionItems = document.querySelectorAll('.action-item');
                const canvas = document.getElementById('workflowCanvas');

                console.log(`🔍 Backup check: ${actionItems.length} items, canvas: ${canvas ? 'found' : 'NOT FOUND'}`);

                // Si WorkflowStudio tiene el método init, llamarlo
                if (typeof WorkflowStudio.init === 'function') {
                    console.log('✅ Re-inicializando WorkflowStudio');
                    WorkflowStudio._dragDropInitialized = true;
                }
            }, 500);
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', ensureDragDrop);
        } else {
            ensureDragDrop();
        }
    })();
    </script>

    <!-- ⚡ CARGA DIFERIDA - Todos los módulos se cargan con defer para máxima velocidad -->

    <!-- Módulos principales - Carga diferida -->
    <script defer src="js/element-spy.js"></script>
    <script defer src="js/video-conference.js"></script>
    <script defer src="js/progress-overlay.js"></script>
    <script defer src="js/recorder-professional.js"></script>
    <script defer src="js/executor.js"></script>
    <script defer src="js/library.js"></script>
    <script defer src="js/ai-dashboard.js"></script>
    <script defer src="js/omnichannel-ui.js"></script>

    <!-- Módulos secundarios - Carga diferida -->
    <script defer src="js/category-toggle.js"></script>
    <script defer src="js/dataframes-manager.js"></script>
    <script defer src="js/ai-config-manager.js"></script>
    <script defer src="js/ai-providers.js"></script>
    <script defer src="js/ai-wizard.js"></script>
    <script defer src="js/workflow-connections.js"></script>
    <script defer src="js/workflow-editor.js"></script>
    <script defer src="js/workflow-views.js"></script>
    <script defer src="js/workflow-exporter.js"></script>
    <script defer src="js/workflow-importer.js"></script>
    <script defer src="js/uipath-migrator.js"></script>
    <script defer src="js/action-properties.js"></script>
    <script defer src="js/workflow-triggers.js"></script>
    <script defer src="js/executor-scheduler.js"></script>
    <script defer src="js/agents-manager.js"></script>
    <script defer src="js/mcp-manager.js"></script>
    <script defer src="js/mcp-properties.js"></script>
    <script defer src="js/variables-manager.js"></script>
    <script defer src="js/sat-agents.js"></script>
    <script defer src="js/settings-manager.js"></script>
    <script defer src="js/database-manager.js"></script>
    <script defer src="js/resizable-panels.js"></script>
    <script defer src="js/component-generator.js"></script>
    <script defer src="js/component-search.js"></script>
    <script defer src="js/component-integrator.js"></script>
    <script defer src="js/video-conference-features.js"></script>

    <!-- External libraries con defer -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
// 🪟 COMPONENTE VENTANAS - Auto-generado
(function() {
    const ventanasComponent = {
  "id": "windows_ventanas_miz32r6e",
  "title": "Ventanas",
  "icon": "fa-window-restore",
  "category": "windows",
  "description": "Detecta y lista todas las ventanas y pestañas abiertas del navegador",
  "generatedAt": "2025-12-09T21:19:35.702Z",
  "prompt": "Componente para detectar ventanas abiertas del navegador y listar todas las pestañas",
  "properties": [
    {
      "name": "action",
      "label": "Acción",
      "type": "select",
      "required": true,
      "default": "list_all",
      "options": [
        {
          "value": "list_all",
          "label": "Listar todas las ventanas y pestañas"
        },
        {
          "value": "get_active",
          "label": "Obtener ventana activa"
        },
        {
          "value": "count_tabs",
          "label": "Contar pestañas abiertas"
        },
        {
          "value": "filter_by_url",
          "label": "Filtrar por URL"
        },
        {
          "value": "filter_by_title",
          "label": "Filtrar por título"
        }
      ],
      "placeholder": "Selecciona la acción a realizar",
      "description": "Tipo de operación a realizar sobre las ventanas"
    },
    {
      "name": "filter",
      "label": "Filtro (opcional)",
      "type": "text",
      "required": false,
      "default": "",
      "placeholder": "Ej: google.com o *facebook*",
      "description": "Texto para filtrar ventanas/pestañas (solo si seleccionaste filtrar)"
    },
    {
      "name": "includeDetails",
      "label": "Incluir detalles completos",
      "type": "checkbox",
      "required": false,
      "default": true,
      "description": "Incluir URL, título, ID y estado de cada pestaña"
    },
    {
      "name": "outputVariable",
      "label": "Variable de salida",
      "type": "text",
      "required": true,
      "default": "ventanas",
      "placeholder": "Nombre de la variable",
      "description": "Nombre de la variable donde se guardará el resultado"
    },
    {
      "name": "format",
      "label": "Formato de salida",
      "type": "select",
      "required": false,
      "default": "json",
      "options": [
        {
          "value": "json",
          "label": "JSON (objeto completo)"
        },
        {
          "value": "array",
          "label": "Array de objetos"
        },
        {
          "value": "count",
          "label": "Solo cantidad"
        },
        {
          "value": "urls",
          "label": "Solo URLs"
        },
        {
          "value": "titles",
          "label": "Solo títulos"
        }
      ],
      "description": "Cómo se formateará la información de salida"
    }
  ]
};

    // Inicializar cuando el DOM esté listo
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initVentanasComponent);
    } else {
        initVentanasComponent();
    }

    function initVentanasComponent() {
        // Esperar a que MCPProperties esté disponible
        const checkInterval = setInterval(() => {
            if (typeof MCPProperties !== 'undefined') {
                clearInterval(checkInterval);

                // Registrar el componente
                MCPProperties[ventanasComponent.id] = ventanasComponent;

                console.log('✅ Componente "Ventanas" registrado:', ventanasComponent.id);

                // Guardar en localStorage
                let generatedComponents = [];
                const saved = localStorage.getItem('generated_components');
                if (saved) {
                    try {
                        generatedComponents = JSON.parse(saved);
                    } catch (e) {
                        console.error('Error parsing generated_components:', e);
                    }
                }

                // Verificar si ya existe
                const exists = generatedComponents.some(c => c.title === 'Ventanas');
                if (!exists) {
                    generatedComponents.push(ventanasComponent);
                    localStorage.setItem('generated_components', JSON.stringify(generatedComponents));
                    console.log('💾 Componente "Ventanas" guardado en localStorage');

                    // Disparar evento para actualizar la UI
                    document.dispatchEvent(new Event('componentsUpdated'));
                }
            }
        }, 100);

        // Timeout de seguridad
        setTimeout(() => clearInterval(checkInterval), 5000);
    }
})();
</script>

<script>
// Inicializar botón de videoconferencia
document.addEventListener('DOMContentLoaded', function() {
    const videoBtn = document.getElementById('videoconference-btn');

    if (videoBtn) {
        videoBtn.addEventListener('click', function() {
            // Obtener workflow actual si existe
            const currentWorkflow = window.currentWorkflowId || 'general';
            const workflowTitle = window.currentWorkflowTitle || 'Sesión de Videoconferencia';

            // Iniciar videoconferencia
            if (window.VideoConference) {
                window.VideoConference.startSession(currentWorkflow, workflowTitle);
            } else {
                console.error('VideoConference no está disponible');
                alert('El sistema de videoconferencia no está cargado correctamente. Recarga la página.');
            }
        });
    }

    console.log('✅ Sistema de Videoconferencia integrado');
});
</script>

<script>
// ⚡ SCRIPT INLINE PARA SIDEBAR Y NAVEGACIÓN - Carga garantizada
(function() {
    console.log('🚀 Ejecutando script inline de sidebar y navegación');

    function initSidebarAndNav() {
        // ========== SIDEBAR TOGGLE ==========
        const sidebar = document.getElementById('mainSidebar');
        const toggleBtn = document.getElementById('sidebarToggle');

        if (sidebar && toggleBtn) {
            console.log('✅ Sidebar y toggle encontrados (inline)');

            // Cargar estado guardado
            const savedState = localStorage.getItem('sidebarCollapsed');
            if (savedState === 'true') {
                sidebar.classList.add('collapsed');
            }

            // Event listener para el toggle
            toggleBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();

                sidebar.classList.toggle('collapsed');
                const isCollapsed = sidebar.classList.contains('collapsed');

                localStorage.setItem('sidebarCollapsed', isCollapsed);
                console.log(isCollapsed ? '📁 Sidebar contraído' : '📂 Sidebar expandido');
            });

            console.log('✅ Toggle del sidebar configurado');
        } else {
            console.error('❌ No se encontró sidebar o toggleBtn');
        }

        // ========== NAVEGACIÓN ==========
        const navItems = document.querySelectorAll('.nav-item');
        console.log(`🔧 Configurando navegación inline para ${navItems.length} items`);

        navItems.forEach(function(item) {
            item.addEventListener('click', function() {
                const viewName = item.getAttribute('data-view');

                // Si no tiene data-view, salir (ej: videoconferencia)
                if (!viewName) {
                    console.log('⚠️ Item sin data-view:', item.id);
                    return;
                }

                console.log('📍 Navegando a:', viewName);

                // Actualizar navegación activa
                navItems.forEach(function(nav) {
                    nav.classList.remove('active');
                });
                item.classList.add('active');

                // Cambiar vista
                const allViews = document.querySelectorAll('.view');
                allViews.forEach(function(view) {
                    view.classList.remove('active');
                });

                const targetView = document.getElementById(viewName + '-view');
                if (targetView) {
                    targetView.classList.add('active');
                    console.log('✅ Vista activada:', viewName);
                } else {
                    console.error('❌ Vista no encontrada:', viewName + '-view');
                }
            });
        });

        console.log('✅ Navegación inline configurada');
    }

    // Ejecutar cuando el DOM esté listo
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initSidebarAndNav);
    } else {
        // DOM ya está listo
        initSidebarAndNav();
    }
})();
</script>

</body>
</html>
